# 📜 Script Hub 脚本编写与注释规范

为了确保脚本在 Script Hub 中能被正确识别、展示并安全运行，请参考以下规范进行编写。

---

## 🔝 1. 顶部注释规范 (重要)

Script Hub 会自动读取脚本文件头部的前 1024 字节，并提取前 5 行注释作为脚本的**功能描述**展示在 Web 界面中。

### 格式要求
- **位置**：必须位于文件最顶部。如果存在 Shebang (如 `#!/bin/bash`)，注释紧随其后。
- **符号**：使用 `#` (Shell/Python) 或 `//` (Java/Javascript)。
- **长度**：系统最多展示前 **5行** 内容。

### 推荐结构
```bash
#!/bin/bash
# [脚本名称]：例如：数据库自动备份工具
# [功能描述]：简述脚本的作用，例如：每天定时备份 MySQL 并上传至 OSS。
# [使用说明]：例如：需要配置环境变量 OSS_KEY，运行命令：curl ... | bash -s -- backup
# [注意事项]：例如：执行前请确保已安装 rsync，建议使用 root 权限。
# [版本信息]：v1.0.0 | 2024-01-30
```

---

## 🛠️ 2. 脚本编写规范

### 2.1 必须包含 Shebang
脚本第一行必须声明解释器，方便直接运行。
- **Shell**: `#!/bin/bash` 或 `#!/bin/sh`
- **Python**: `#!/usr/bin/env python3`
- **Node.js**: `#!/usr/bin/env node`

### 2.2 增强脚本健壮性 (Bash)
建议在脚本开头添加以下配置，防止意外损坏系统：
```bash
set -e          # 遇到错误立即退出
set -u          # 使用未定义的变量时报错退出
set -o pipefail # 管道命令中只要有一个失败，整个管道就视为失败
```

### 2.3 路径处理
尽量使用绝对路径或基于脚本所在位置的相对路径：
```bash
# 获取脚本所在目录的绝对路径
SCRIPT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
```

### 2.4 幂等性设计
确保脚本多次运行的结果是一致的。
- 检查文件/目录是否存在，而不是直接报错。
- 检查软件包是否已安装，避免重复安装。
- 配置修改前先检查是否已存在对应配置。

---

## 🛡️ 3. 安全建议

### 3.1 禁止硬编码敏感信息
**严禁**在脚本中直接写入明文密码、API Token 等。
- 推荐做法：通过环境变量传入，或在脚本运行时通过交互式输入。
- 示例：`DB_PASS=${1:-$DEFAULT_PASSWORD}`

### 3.2 权限控制
- 脚本文件在上传后，默认权限应尽量保持为 `644` 或 `755`。
- 如果脚本需要 `root` 权限执行，请在打印的描述中明确标注。

---

## 🎨 4. 输出美化 (Bash 示例)
为了让 `curl | bash` 的输出在终端更易读，建议定义颜色变量：

```bash
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}SUCCESS:${NC} 任务已完成"
echo -e "${RED}ERROR:${NC} 配置文件丢失"
```

---

*遵循此规范将显著提升脚本在仓库中的可读性与维护性。*
